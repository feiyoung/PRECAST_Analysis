batch.facLoc = batch_facLoc,
batch.facScale = batch_facScale,
nGenes = ngenes,
group.prob = group_prob,
out.prob = 0,
de.prob = de_prop,
de.facLoc = de_facLoc,
de.facScale = de_facScale,
seed = sim_seed)
sim_groups <- splatSimulate(
params = params,
method = "groups",
verbose = FALSE)
## reorder the sample to  be the same as y
meta_data_all <- colData(sim_groups)
# y <- as.character(seu@meta.data[,c("layer_guess_reordered")])
# Groupy = y
y <- as.numeric(seu@meta.data[,c("layer_guess_reordered")])
Groupy = paste0("Group", y)
K <- length(unique(y))
nbatch <- 1
pos <- cbind(seu$row, seu$col)
idxList_sim <- list()
idxList_pos <- list(1:length(y), which(pos[,1]< quantile(pos[,1], 0.9)),
which(pos[,2]< quantile(pos[,2], 0.9)))
### Ensure the locations of each spot
posList <- lapply(idxList_pos, function(idx) pos[idx, ])
yList <- lapply(idxList_pos, function(idx) Groupy[idx])
for(r in 1:nbatch){
message("r = ", r)
y_tmp <- yList[[r]]
num_each_celltype = table(y_tmp)
y_unique <- sort(unique(y_tmp))
K_tmp <- length(y_unique)
idx1 = rep(0, length(y_tmp))
for (i in 1:K_tmp){
# i <- 1
idx1[y_tmp==y_unique[i]] = which(meta_data_all[,3] == y_unique[i] & meta_data_all[,2]==paste0("Batch", r))[1:num_each_celltype[i]]
}
idxList_sim[[r]] <- idx1 ## align with posList
}
sceList_sim <- lapply(idxList_sim, function(idx) sim_groups[,idx])
## Add spatial coordinates
sceList_sim <- lapply(1: nbatch, function(r){
sce <- sceList_sim[[r]]
colData(sce)$row <- posList[[r]][,1]
colData(sce)$col <- posList[[r]][,2]
return(sce)
})
sce2seurat <- function(sce){
# sce <- sceList_sim[[1]]
require(SingleCellExperiment)
count <- counts(sce)
meta_data <- as.data.frame(colData(sce))
require(Seurat)
seu <- CreateSeuratObject(counts=count, meta.data = meta_data)
return(seu)
}
seuList_use <- pbapply::pblapply(sceList_sim, sce2seurat)
return(seuList_use)
}
library(Seurat)
pbmc_small$row <- runif(ncol(pbmc_small))
pbmc_small$col <- runif(ncol(pbmc_small))
generate_seuList(pbmc_small)
library(SRTsim)
shinySRT1 <- SRTsim_shiny()
#shinySRT1 <- SRTsim_shiny()
str(exampleLIBD)
simSRT  <- createSRT(count_in=example_count,loc_in =example_loc)
colnames(example_loc) <- c("x","y","label")
#shinySRT1 <- SRTsim_shiny()
str(exampleLIBD)
example_count   <- exampleLIBD$count
example_loc     <- exampleLIBD$info[,c("imagecol","imagerow","layer")]
colnames(example_loc) <- c("x","y","label")
simSRT  <- createSRT(count_in=example_count,loc_in =example_loc)
simSRT
## Set a seed for reproducible simulation
set.seed(1)
## Estimate model parameters for data generation
simSRT1 <- srtsim_fit(simSRT,sim_schem="tissue")
## Generate synthetic data with estimated parameters
simSRT1 <- srtsim_count(simSRT1)
## Set a seed for reproducible simulation
set.seed(1)
## Estimate model parameters for data generation
simSRT2 <- srtsim_fit(simSRT,sim_schem="domain")
## Generate synthetic data with estimated parameters
simSRT2 <- srtsim_count(simSRT2)
## Compute metrics
simSRT1   <- compareSRT(simSRT1)
## Visualize Metrics
visualize_metrics(simSRT1)
visualize_gene(simsrt=simSRT1,plotgn = "ENSG00000183036",rev_y=TRUE)
visualize_gene(simsrt=simSRT2,plotgn = "ENSG00000168314",rev_y=TRUE)
srtsim_fit
str(simSRT1)
simSRT2
40000*0.16
40000*0.84
40000*0.2
8000+(40000-8000)*0.8
ordered.cls.ids.list<- list('11'=1,'3'=2,'6'=3, '9'=4,'1'=5,'7'='6','8'=7,'5'= 8, '4'=9, "10"=10, "2"=11)
ordered.cls.ids.list
library(SPATAData)
library(SPATA2)
object_t269 <- loadSpataObject(sample_name = "269_T")
devtools::install_github(repo = "theMILOlab/SPATA2")
5703+2004
6146+2354+5899
5618+5354
library(Seurat)
?CreateSeuratObject
library(ProFAST)
dif.file <- "D:/LearnFiles/Research paper/IntTemporalSpatial/RcppCode/Rpackage/github_ProFAST/ProFAST/vignettes_data/"
dlpfc2 <- readRDS(paste0(dif.file,"seulist2_ID9_10.RDS"))
dlpfc <- dlpfc2[[1]]
dlpfc
coembedSRT::FAST_single_coembed
coembedSRT::NCFM_fast
FAST_single_coembed <- function (X, Adj_sp, q = 15, features = NULL, ...){
require(ProFAST)
require(Matrix)
if (is.null(features)) {
features <- row.names(X)
}
else {
features <- intersect(features, row.names(X))
}
reslist <- FAST_run(XList = list(Matrix::t(X[features, ])),
AdjList = list(Adj_sp), q = q, fit.model = "gaussian",
...)
ce_cell <- reslist$hV[[1]]
row.names(ce_cell) <- colnames(X)
return(ce_cell)
}
FAST_single <- function (seu, Adj_sp, q = 15, slot = "data", assay = NULL, reduction.name = "fast",
var.features = NULL, ...){
if (is.null(assay))
assay <- DefaultAssay(seu)
X_all <- as.matrix(GetAssayData(object = seu, slot = slot,
assay = assay))
if (is.null(var.features)) {
if (length(seu@assays[[assay]]@var.features) == 0) {
seu <- FindVariableFeatures(seu, nfeatures = min(nfeatures,
nrow(seu)), assay = assay)
}
var.features <- seu@assays[[assay]]@var.features
}
else {
var.features <- intersect(var.features, rownames(seu@assays[[assay]]))
}
cellsCoordinates <- FAST_single_coembed(X = X_all, Adj_sp = Adj_sp, q = q,
features = var.features, ...)
colnames(cellsCoordinates) <- paste0("fast", 1:q)
seu@reductions[[reduction.name]] <- CreateDimReducObject(embeddings = cellsCoordinates[colnames(seu), ],
key = paste0(gsub("_","", reduction.name), "_"), assay = assay)
return(seu)
}
pos <- cbind(dlpfc$row, dlpfc$col)
pos <- cbind(dlpfc$row, dlpfc$col)
Adj_sp <- PRECAST::getAdj_reg(pos=pos, platform = "Visium")
seu <- FAST_single(dlpfc, Adj_sp)
library(Seurat)
Adj_sp <- PRECAST::getAdj_reg(pos=pos, platform = "Visium")
seu <- FAST_single(dlpfc, Adj_sp)
FAST
seu
FAST_single <- function (seu, Adj_sp, q = 15, fit.model=c('gaussian', 'poisson'), slot = "data", assay = NULL, reduction.name = "fast",
...){
fit.model <- match.arg(fit.model)
if (is.null(assay))
assay <- DefaultAssay(seu)
X_all <- as.matrix(GetAssayData(object = seu, slot = slot,
assay = assay))
if (length(seu@assays[[assay]]@var.features) == 0) {
seu <- FindVariableFeatures(seu, nfeatures = min(nfeatures,
nrow(seu)), assay = assay)
}
var.features <- seu@assays[[assay]]@var.features
cellsCoordinates <- FAST_s(X = X_all, Adj_sp = Adj_sp, q = q,
features = var.features, ...)
colnames(cellsCoordinates) <- paste0("fast", 1:q)
seu@reductions[[reduction.name]] <- CreateDimReducObject(embeddings = cellsCoordinates[colnames(seu), ],
key = paste0(gsub("_","", reduction.name), "_"), assay = assay)
return(seu)
}
FAST_s <- function (X, Adj_sp, q = 15, fit.model='gaussian', features = NULL, ...){
require(ProFAST)
require(Matrix)
if (is.null(features)) {
features <- row.names(X)
}
else {
features <- intersect(features, row.names(X))
}
reslist <- FAST_run(XList = list(Matrix::t(X[features, ])),
AdjList = list(Adj_sp), q = q, fit.model = fit.model,
...)
ce_cell <- reslist$hV[[1]]
row.names(ce_cell) <- colnames(X)
return(ce_cell)
}
FAST_single <- function (seu, Adj_sp, q = 15, fit.model=c('gaussian', 'poisson'), slot = "data", assay = NULL, reduction.name = "fast",
...){
fit.model <- match.arg(fit.model)
if (is.null(assay))
assay <- DefaultAssay(seu)
X_all <- as.matrix(GetAssayData(object = seu, slot = slot,
assay = assay))
if (length(seu@assays[[assay]]@var.features) == 0) {
seu <- FindVariableFeatures(seu, nfeatures = min(nfeatures,
nrow(seu)), assay = assay)
}
var.features <- seu@assays[[assay]]@var.features
cellsCoordinates <- FAST_s(X = X_all, Adj_sp = Adj_sp, q = q,
features = var.features, ...)
colnames(cellsCoordinates) <- paste0("fast", 1:q)
seu@reductions[[reduction.name]] <- CreateDimReducObject(embeddings = cellsCoordinates[colnames(seu), ],
key = paste0(gsub("_","", reduction.name), "_"), assay = assay)
return(seu)
}
seu <- FAST_single(dlpfc, Adj_sp, maxIter=4)
seu
seu <- RunUMAP(seu, reduction = "fast")
seu <- RunUMAP(seu, reduction = "fast", dims=1:15)
seu <- FindNeighbors(seu, reduction = 'fast')
seu <- FindClusters(seu)
seu <- FindClusters(seu, resolution = 0.4)
UMAPPlot(seu)
colnames(pos) <- paste0("Spatial",1:2)
seu <- PRECAST::Add_embed(embed = pos, seu, embed_name = 'Spatial')
seu
DimPlot(seu)
DimPlot(seu, reduction = 'Spatial')
?DimPlot
DimPlot(seu, reduction = 'Spatial', pt.size = 10)
DimPlot(seu, reduction = 'Spatial', pt.size = 5)
DimPlot(seu, reduction = 'Spatial', pt.size = 3)
plot
plot(1:10)
library(help=Seurat)
data(pbmc_small)
library(Seurat)
pbmc_small
library(help = SeuratObject)
install.packages("SeuratObject")
install.packages("SeuratObject")
1
ininstall.packages("SeuratObject")
install.packages("SeuratObject")
1
install.packages("SeuratObject")
library(help=SeuratObject)
install.packages("Seurat")
library(help=Seurat)
(0.576-0.526)/0.526
(0.98-0.95)/0.95
(0.966- 0.788)/0.788
library(ProFAST)
(145-122)*5.093
211.50-166.89
5000-117.14+44.61
?gost
library(gprofiler2)
？gost
?gost
library(ProFAST)
example("coembedding_umap")
?coembedding_umap
library(help = scater)
library(help = matrixStats)
remotes::install_version('matrixStats', version='1.1.0')
## generalizedPCA
library(generalizedPCA)
?generalizedPCA
generalizedPCA
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
gendata_sp
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
SMMGFM
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
128/18
64/18
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
source('D:/LearnFiles/Research paper/idea/TodoProjects/SpatialGFM/Rcode/simu1.R')
18*2
18*3
36*4
X
X <- cbind(c(1,1), c(1,1))
X
svd(X)
svdx = svd(X)
Matrix::rankMatrix(svdx$u)
Y <- matrix(1, 3,3)
svd(Y)
library(Matrix)
library(PRECAST)
IntegrateSpaData
library(data.table)
?fread
?CreateSeuratObject
sum(duplicated(gene_expression$V1))
?saveRDS
library(Seurat)
?CreateSeuratObject
seu_rna <- CreateSeuratObject(counts=dat_rna, meta.data = dat_pos_use,
min.cells = 10, min.features = 10)
library(randomForest)
?randomForest
2.7*(3.3+2.4)+6*3
1.6*4.84
35/0.64*50
55*35
## generalizedPCA
# install.packages("GFM")
library(generalizedPCA)
?generalizedPCA
generalizedPCA:::check_family
ProFAST::get_r2_mcfadden
8000 / 600
50/13.33333
library(PRECAST)
PRECAST
ICM.EM
simutool::colorbar_adj_transparent
library(PRECAST)
PRECASTObj
PRECASTObj@resList
str(PRECASTObj@resList)
1586+66.45+1698.24+849.12+332.23+260.21
1586+66.45+1698.24+849.12+332.23+260.21+2968.6
69.12/13
# 步骤1：创建数据
categories <- factor(c("A", "A", "A", "B", "B", "B", "C", "C", "A", "C"))
# 步骤2：转换数据
# 假设我们为每个类别分配了一个数值（这里只是一个示例）
category_values <- as.numeric(categories)
library(pheatmap)
pheatmap(category_values,cluster_cols = F, cluster_rows = F)
?pheatmap
pheatmap(category_values,cluster_cols = F, cluster_rows = F,
color=c("red", "blue", "green"))
pheatmap(category_values,cluster_cols = F, cluster_rows = F,
color=c("#C94544", "#9DDBF8", "#EFC76B"))
library(simutool)
simutool::remove_claim_cpp_object("update_R(const cube& H_y, const cube& M, const mat& mu, const cube& S1,
const cube& S2, const mat& C,
const vec& Lam1, const vec& Lam2, mat& R)")
remove_claim_cpp_object("update_C(const cube& H_y, const cube& M, const mat& mu, const cube& S1,
const cube& S2, const mat& R,
const vec& Lam1, const vec& Lam2, mat& C)")
remove_claim_cpp_object("update_Lam1(const cube& H_y, const cube& S_y, const cube& M, const mat& mu,
const mat& R,
const mat& C, const vec& Lam2, vec& Lam1)")
remove_claim_cpp_object("update_Lam2(const cube& H_y, const cube& S_y, const cube& M, const mat& mu,
const mat& R,
const mat& C, const vec& Lam2, vec& Lam1)")
remove_claim_cpp_object("update_Lam2(const cube& H_y, const cube& S_y, const cube& M, const mat& mu,
const mat& R,
const mat& C, const vec& Lam1, vec& Lam2)")
remove_claim_cpp_object("update_A(const cube& M,  const cube& S1,
const cube& S2, const mat& B, mat& A)")
remove_claim_cpp_object("update_B(const cube& M,  const cube& S1,
const cube& S2, const mat& A, mat& B)")
library(rgTest)
?rg.test
?TransferData
library(Seurat)
?TransferData
ProFAST::get_r2_mcfadden
exp(-1)/2
setwd("D:\\LearnFiles\\Research paper\\IntTemporalSpatial\\simu_dr")
### DR.SC
library(DR.SC)
DR.SC_fit
# Output the PRECAST clusters as manual annotation ------------------------
setwd("F:\\LiuWei\\Projects\\iDR_SC\\IntegrateCluster\\RealData\\HCC4Data")
# Output the PRECAST clusters as manual annotation ------------------------
setwd("E:\\LiuWei\\Projects\\iDR_SC\\IntegrateCluster\\RealData\\HCC4Data")
# Output the PRECAST clusters as manual annotation ------------------------
setwd("E:\\Research paper\\IntegrateDRcluster\\RealData\\HCC4Data")
load("HCC4_clusterK9_renumber_idrsc.rds")
str(cluster_idrsc_renumber)
setwd("E:\\Research paper\\IntegrateDRcluster\\AnalysisCode\\PRECAST_Analysis\\Real_data_analysis\\data")
seu_hcc1 <- readRDS("HCC1_seu.RDS")
library(Seurat)
seu_hcc1
str(cluster_idrsc_renumber)
head(seu_hcc1)
plot(seu_hcc1$row, seu_hcc1$col, cols=factor(cluster_idrsc_renumber[[1]]))
plot(seu_hcc1$row, seu_hcc1$col, col=factor(cluster_idrsc_renumber[[1]]))
meta_data <- seu_hcc1@meta.data
s <- 1
factor(cluster_idrsc_renumber[[s]], levels = 1:9)
head(meta_data)
s <- 1
precast.clusters <- cluster_idrsc_renumber[[s]]
precast.clusters
Idents(seu_hcc1) <- precast.clusters
precast.clusters <- factor(cluster_idrsc_renumber[[s]], levels = 1:9)
Idents(seu_hcc1) <- precast.clusters
table(Idents(seu_hcc1) )
## annotation: 1-5: TNE1: TNE5, Stroma1: Stroma4.
new.names <- 1:9
names(new.names) <- c(paste0("TNE",1:5), paste0("Stroma", 1:4))
new.names
?RenameIdents
RenameIdents(seu_hcc1, new.names)
Idents(seu_hcc1) <- precast.clusters
RenameIdents(seu_hcc1, new.names)
new.names
## annotation: 1-5: TNE1: TNE5, Stroma1: Stroma4.
#new.names <- 1:9
new.names <- c(paste0("TNE",1:5), paste0("Stroma", 1:4))
names(new.names) <- 1:9
RenameIdents(seu_hcc1, new.names)
table(Idents(RenameIdents(seu_hcc1, new.names)))
meta_data$precast.clusters <- precast.clusters
meta_data$manual.annotation <- Idents(seu_hcc1)
write.csv(meta_data, file=paste0("meta.data_HCC", s, ".csv"))
seu_hcc1 <- RenameIdents(seu_hcc1, new.names)
meta_data$manual.annotation <- Idents(seu_hcc1)
write.csv(meta_data, file=paste0("meta.data_HCC", s, ".csv"))
write.csv(meta_data, file=paste0("meta.data_HCC", s, ".csv"))
library(Seurat)
for(s in 2:4){
# s <- 1
message("s = ", s)
seu_hcc1 <- readRDS(paste0("HCC", s,"_seu.RDS"))
seu_hcc1
head(seu_hcc1)
precast.clusters <- factor(cluster_idrsc_renumber[[s]], levels = 1:9)
Idents(seu_hcc1) <- precast.clusters
plot(seu_hcc1$row, seu_hcc1$col, col=)
meta_data <- seu_hcc1@meta.data
## annotation: 1-5: TNE1: TNE5, Stroma1: Stroma4.
#new.names <- 1:9
new.names <- c(paste0("TNE",1:5), paste0("Stroma", 1:4))
names(new.names) <- 1:9
seu_hcc1 <- RenameIdents(seu_hcc1, new.names)
meta_data$precast.clusters <- precast.clusters
meta_data$manual.annotation <- Idents(seu_hcc1)
write.csv(meta_data, file=paste0("meta.data_HCC", s, ".csv"))
}
library(PRECAST)
seu_hcc1 <- Add_embed(seu_hcc1@meta.data[,c("row", 'col')], seu=seu_hcc1, embed_name = 'pos')
seu_hcc1 <- Add_embed(as.matrix(seu_hcc1@meta.data[,c("row", 'col')]), seu=seu_hcc1, embed_name = 'pos')
DimPlot(seu_hcc1)
DimPlot(seu_hcc1, reduction = 'pos')
DimPlot(seu_hcc1, reduction = 'pos', pt.size = 2)
